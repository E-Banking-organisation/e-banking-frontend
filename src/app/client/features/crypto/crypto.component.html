<div class="crypto-container">
  <div class="header">
    <h2>Portefeuille Crypto</h2>
    <div class="total-value">
      <span>Valeur totale: Indisponible</span>
    </div>
  </div>

  <div class="tabs">
    <div class="tab" [class.active]="activeTab === 'balance'" (click)="setActiveTab('balance')">Mon Portefeuille</div>
    <div class="tab" [class.active]="activeTab === 'market'" (click)="setActiveTab('market')">Marché</div>
    <div class="tab" [class.active]="activeTab === 'transactions'" (click)="setActiveTab('transactions')">Historique</div>
  </div>

  <!-- Mon Portefeuille -->
  <div *ngIf="activeTab === 'balance'" class="tab-content">
    <div class="wallet-section">
      <h3>Vos Cryptomonnaies</h3>
      <div *ngIf="wallets.length === 0" class="empty-state">
        <p>Aucun portefeuille trouvé.</p>
        <button (click)="setActiveTab('market')" class="btn-primary">Acheter des cryptos</button>
      </div>
      <ul *ngIf="wallets.length > 0" class="wallet-list">
        <li *ngFor="let wallet of wallets" class="wallet-item">
          <strong>{{ getCryptoById(toNumber(wallet.crypto)).name }}</strong> — {{ getCryptoBalance(toNumber(wallet.crypto)) }} unités
        </li>
      </ul>
    </div>
  </div>

  <!-- Marché -->
  <div *ngIf="activeTab === 'market'" class="tab-content">
    <div class="transaction-section">
      <h3>Nouvelle Transaction</h3>
      <div class="transaction-type-selector">
        <button [class.active]="transactionType === 'ACHAT'" (click)="setTypeOperation('ACHAT')">Acheter</button>
        <button [class.active]="transactionType === 'VENTE'" (click)="setTypeOperation('VENTE')">Vendre</button>
      </div>
      <div class="form-group">
        <label for="crypto">Crypto :</label>
        <input id="crypto" type="text" [(ngModel)]="selectedCrypto" placeholder="Ex: BTC, ETH" (ngModelChange)="selectCrypto($event)" />
      </div>
      <div class="form-group">
        <label for="amount">Quantité :</label>
        <input id="amount" type="number" [(ngModel)]="transactionAmount" min="0" step="0.00001" />
      </div>
      <div class="form-group">
        <label for="account">Compte associé :</label>
        <select id="account" [(ngModel)]="selectedAccountId" [disabled]="accounts.length === 0">
          <option *ngIf="accounts.length === 0" disabled>Aucun compte disponible</option>
          <option *ngFor="let account of accounts" [value]="account.id">
            {{ account.accountNumber }} ({{ account.type }} - {{ account.balance }} {{ account.currency }})
          </option>
        </select>
      </div>
      <button class="btn-primary" [disabled]="transactionAmount <= 0 || !selectedCrypto || !selectedAccountId" (click)="executeTransaction()">
        Confirmer {{ transactionType === 'ACHAT' ? 'l’achat' : 'la vente' }}
      </button>
    </div>
  </div>

  <!-- Historique des transactions -->
  <div *ngIf="activeTab === 'transactions'" class="tab-content">
    <div class="history-section">
      <h3>Historique des Transactions</h3>
      <table *ngIf="transactions.length > 0">
        <thead>
        <tr>
          <th>Type</th>
          <th>Crypto</th>
          <th>Quantité</th>
          <th>Date</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let tx of transactions">
          <td [class.buy]="tx.typeOperation === 'ACHAT'" [class.sell]="tx.typeOperation === 'VENTE'">
            {{ tx.typeOperation }}
          </td>
          <td>{{ getCryptoById(toNumber(tx.crypto)).symbol }}</td>
          <td>{{ tx.quantiteCrypto }}</td>
          <td>{{ tx.date | date:'dd/MM/yyyy HH:mm' }}</td>
        </tr>
        </tbody>
      </table>
      <div *ngIf="transactions.length === 0" class="empty-state">
        Aucune transaction enregistrée.
      </div>
    </div>
  </div>
</div>
